# Data Model: Mobile PWA

**Feature**: 001-mobile-pwa
**Date**: 2026-01-01
**Status**: Presentation Layer Only - No New Data Models

---

## Overview

This feature is a **presentation-layer enhancement** only. No new data entities, database schemas, or API contracts are introduced. The Mobile PWA feature adapts existing pages and components for mobile devices and adds Progressive Web App capabilities.

---

## Existing Data Entities (Unchanged)

All existing entities from the AI Portal platform remain unchanged. This section documents the entities that will be consumed by mobile-responsive UI components.

### Articles (Blog Posts)

**Source**: Strapi CMS `articles` collection

**Fields**:
- `id`: string (unique identifier)
- `title`: string (article title)
- `body`: string (markdown content)
- `author`: string (author name)
- `createdAt`: string (ISO 8601 timestamp)
- `updatedAt`: string (ISO 8601 timestamp)
- `publishedAt`: string (ISO 8601 timestamp)
- `categories`: array of category references
- `description`: string (excerpt/summary)

**Access Pattern**: Server route `/api/articles` → Composable `useFetchArticles()` → UI components

### Prompts (AI Instructions)

**Source**: Strapi CMS `prompts` collection

**Fields**:
- `id`: string
- `promptSlug`: string (URL-friendly identifier)
- `title`: string (prompt name)
- `content`: string (prompt template text)
- `category`: string reference
- `tags`: array of strings
- `createdAt`: string
- `updatedAt`: string

**Access Pattern**: Server route `/api/prompts` → Composable `usePrompts()` → UI components

### Research Sessions (AI Chat)

**Source**: Strapi CMS `research-sessions` collection

**Fields**:
- `id`: string
- `searchId`: string (unique session identifier)
- `title`: string (session name)
- `messages`: array of chat messages
- `createdAt`: string
- `updatedAt`: string

**Access Pattern**: Server route `/api/research/[searchId]` → Composable `useResearch()` → UI components

---

## No New Data Models

### Reasoning

1. **Presentation-Layer Only**: This feature adapts existing UI for mobile viewports (320px-768px)
2. **PWA Features**: Service worker caching uses existing API routes, no new data structures
3. **Component Adaptations**: Mobile versions of existing components use same data contracts
4. **No Backend Changes**: All functionality remains unchanged, only layout and interaction patterns adapt

### Data Flow (Unchanged)

The existing data flow architecture remains intact:

```
Client UI (Mobile/Desktop)
    ↓
Composables (useFetchArticles, usePrompts, useResearch)
    ↓
Nuxt Server Routes (/api/articles, /api/prompts, /api/research)
    ↓
Backend (Strapi CMS)
```

---

## Client-Side State (New)

While no new backend data models are introduced, some client-side state may be managed for PWA and mobile features:

### PWA Install Prompt

**State**: Whether install prompt is available/dismissed

**Implementation**:
```typescript
// composables/usePWAInstall.ts
export const usePWAInstall = () => {
  const deferredPrompt = ref<Event | null>(null)
  const showInstallPrompt = ref(false)

  onMounted(() => {
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault()
      deferredPrompt.value = e
      showInstallPrompt.value = true
    })
  })

  const install = async () => {
    if (!deferredPrompt.value) return

    deferredPrompt.value.prompt()
    const { outcome } = await deferredPrompt.value.userChoice

    if (outcome === 'accepted') {
      deferredPrompt.value = null
      showInstallPrompt.value = false
    }
  }

  const dismiss = () => {
    showInstallPrompt.value = false
  }

  return {
    showInstallPrompt,
    install,
    dismiss
  }
}
```

### Offline Status

**State**: Whether application is currently offline

**Implementation**:
```typescript
// composables/useOfflineStatus.ts
export const useOfflineStatus = () => {
  const isOnline = ref(true)
  const isOffline = computed(() => !isOnline.value)

  onMounted(() => {
    isOnline.value = navigator.onLine

    window.addEventListener('online', () => {
      isOnline.value = true
    })

    window.addEventListener('offline', () => {
      isOnline.value = false
    })
  })

  return {
    isOnline,
    isOffline
  }
}
```

### Mobile Detection

**State**: Whether current viewport is mobile-sized

**Implementation**:
```typescript
// Use Vuetify's useDisplay()
import { useDisplay } from 'vuetify'

const { mobile } = useDisplay()
// mobile.value is true for screens < 600px
```

---

## PWA-Specific Data (Configuration)

### Web App Manifest

**File**: `public/manifest.json` (auto-generated by @vite-pwa/nuxt)

**Metadata**:
```json
{
  "name": "AI Portal - Библиотека AI-инструментов",
  "short_name": "AI Portal",
  "description": "Библиотека промптов и AI-инструментов для операционных команд",
  "theme_color": "#ff1493",
  "background_color": "#ffffff",
  "display": "standalone",
  "orientation": "portrait",
  "scope": "/",
  "start_url": "/",
  "icons": [...]
}
```

**Note**: This is configuration, not a data model. No database storage required.

### Service Worker Cache Storage

**Storage**: Browser Cache API (managed by Workbox)

**Cache Names**:
- `strapi-api-cache`: API responses (24-hour expiration)
- `image-cache`: Images and static assets (7-day expiration)
- `font-cache`: Font files (1-year expiration)
- `workbox-precache-v2`: App shell (JS/CSS/HTML)

**Note**: Cache storage is managed by the browser, not application data models.

---

## Summary

| Aspect | Status | Details |
|--------|--------|---------|
| **New Data Entities** | None | Presentation layer only |
| **Database Changes** | None | No backend modifications |
| **API Contracts** | None | Existing server routes unchanged |
| **Client-Side State** | Minimal | PWA install prompt, offline status, mobile detection |
| **PWA Configuration** | Added | Manifest, service worker (non-data artifacts) |

---

## Next Steps

Since no new data models are required:

1. Proceed to **[contracts/](contracts/)** for PWA configuration files
2. Proceed to **[quickstart.md](quickstart.md)** for mobile development setup
3. Skip database migrations or API endpoint development

All implementation work will focus on:
- Responsive layout adaptations (320px-768px viewports)
- Touch-optimized interactions
- PWA manifest and service worker configuration
- Mobile testing infrastructure
